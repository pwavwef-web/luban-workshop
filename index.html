<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Luban Workshop Restaurant</title>
    <link rel="icon" type="image/jpeg" href="favicon.jpeg">

    <script src="https://cdn.tailwindcss.com"></script>

    <link
        href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Lato:wght@300;400;700&display=swap"
        rel="stylesheet">

    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <style>
        body {
            font-family: 'Lato', sans-serif;
        }

        h1,
        h2,
        h3,
        .serif {
            font-family: 'Playfair Display', serif;
        }

        .scroll-smooth {
            scroll-behavior: smooth;
        }

        /* Custom Scrollbar for the menu */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>

<body class="bg-stone-50 text-stone-800 scroll-smooth antialiased">

    <nav class="fixed top-0 w-full bg-white/95 backdrop-blur-sm shadow-md z-50 transition-all duration-300">
        <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex-shrink-0 flex items-center cursor-pointer" onclick="window.scrollTo(0,0)">
                    <i data-lucide="utensils-crossed" class="h-6 w-6 text-red-700 mr-2"></i>
                    <span class="serif font-bold text-xl tracking-tight text-stone-900">Luban <span
                            class="text-red-700">Workshop</span></span>
                </div>

                <div class="hidden md:flex space-x-8 items-center">
                    <a href="#menu" class="text-stone-600 hover:text-red-700 transition-colors font-medium">Our Menu</a>
                    <a href="#reservation"
                        class="text-stone-600 hover:text-red-700 transition-colors font-medium">Reserve</a>
                    <a href="#my-orders" id="my-orders-link-desktop"
                        class="hidden text-stone-600 hover:text-red-700 transition-colors font-medium">My Orders</a>
                    <a href="#location" class="text-stone-600 hover:text-red-700 transition-colors font-medium">Locate
                        Us</a>
                    <button onclick="toggleCart()"
                        class="relative p-2 text-stone-600 hover:text-red-700 transition-colors">
                        <i data-lucide="shopping-bag" class="h-6 w-6"></i>
                        <span id="cart-badge-desktop"
                            class="absolute top-0 right-0 inline-flex items-center justify-center px-2 py-1 text-xs font-bold leading-none text-white transform translate-x-1/4 -translate-y-1/4 bg-red-700 rounded-full hidden">0</span>
                    </button>
                    <button id="auth-btn-desktop" onclick="toggleAuthModal()"
                        class="px-4 py-2 text-sm font-medium text-white bg-red-700 rounded-md hover:bg-red-800 transition-colors">
                        Sign Up / Login
                    </button>
                    <button id="user-info-desktop" onclick="logout()"
                        class="hidden items-center gap-2 px-4 py-2 text-sm font-medium text-stone-600 hover:text-red-700 transition-colors">
                        <i data-lucide="user" class="h-4 w-4"></i>
                        <span id="user-email-desktop"></span>
                    </button>
                </div>

                <div class="flex items-center md:hidden gap-4">
                    <button onclick="toggleCart()" class="relative p-2 text-stone-600">
                        <i data-lucide="shopping-bag" class="h-6 w-6"></i>
                        <span id="cart-badge-mobile"
                            class="absolute top-0 right-0 inline-flex items-center justify-center px-2 py-1 text-xs font-bold leading-none text-white transform translate-x-1/4 -translate-y-1/4 bg-red-700 rounded-full hidden">0</span>
                    </button>
                    <button onclick="document.getElementById('mobile-menu').classList.toggle('hidden')"
                        class="text-stone-600 hover:text-red-700 p-2">
                        <i data-lucide="menu" class="h-6 w-6"></i>
                    </button>
                </div>
            </div>
        </div>

        <div id="mobile-menu" class="hidden md:hidden bg-white border-t border-stone-100">
            <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
                <a href="#menu"
                    class="block px-3 py-2 rounded-md text-base font-medium text-stone-700 hover:text-red-700 hover:bg-stone-50">Menu</a>
                <a href="#reservation"
                    class="block px-3 py-2 rounded-md text-base font-medium text-stone-700 hover:text-red-700 hover:bg-stone-50">Reserve</a>
                <a href="#my-orders" id="my-orders-link-mobile"
                    class="hidden px-3 py-2 rounded-md text-base font-medium text-stone-700 hover:text-red-700 hover:bg-stone-50">My Orders</a>
                <a href="#location"
                    class="block px-3 py-2 rounded-md text-base font-medium text-stone-700 hover:text-red-700 hover:bg-stone-50">Location</a>
                <button id="auth-btn-mobile" onclick="toggleAuthModal()"
                    class="w-full text-left px-3 py-2 rounded-md text-base font-medium text-white bg-red-700 hover:bg-red-800">Sign
                    Up / Login</button>
                <button id="user-info-mobile" onclick="logout()"
                    class="hidden w-full text-left px-3 py-2 rounded-md text-base font-medium text-stone-700 hover:text-red-700 hover:bg-stone-50">
                    <i data-lucide="user" class="h-4 w-4 inline mr-2"></i>
                    <span id="user-email-mobile"></span>
                </button>
            </div>
        </div>
    </nav>

    <header class="relative pt-24 pb-12 lg:pt-32 lg:pb-24 bg-stone-900 overflow-hidden">
        <div class="absolute inset-0 opacity-40">
            <img src="https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?ixlib=rb-4.0.3&auto=format&fit=crop&w=1470&q=80"
                alt="Restaurant interior" class="w-full h-full object-cover">
        </div>
        <div class="relative max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <h1 class="serif text-4xl sm:text-5xl md:text-6xl font-bold text-white mb-6 drop-shadow-lg">
                Craftsmanship in <br />Every Bite
            </h1>
            <p class="mt-4 text-xl text-stone-200 max-w-2xl mx-auto mb-10 drop-shadow-md">
                Experience the culinary excellence of the Luban Workshop. Where technical precision meets traditional
                flavor.
            </p>
            <div class="flex justify-center gap-4">
                <a href="#menu"
                    class="px-8 py-3 border border-transparent text-base font-medium rounded-md text-stone-900 bg-white hover:bg-stone-100 md:py-4 md:text-lg md:px-10 shadow-lg transition-transform active:scale-95">
                    Order Now
                </a>
                <a href="#location"
                    class="px-8 py-3 border border-white text-base font-medium rounded-md text-white hover:bg-white/10 md:py-4 md:text-lg md:px-10 shadow-lg transition-transform active:scale-95">
                    Find Us
                </a>
            </div>
        </div>
    </header>

    <section id="menu" class="py-16 bg-white">
        <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-12">
                <span class="text-red-700 font-semibold tracking-wide uppercase text-sm">Discover Our Menu</span>
                <h2 class="mt-2 text-3xl leading-8 font-extrabold tracking-tight text-stone-900 sm:text-4xl serif">
                    Signature Dishes
                </h2>
                <p class="mt-4 max-w-2xl text-xl text-stone-500 mx-auto">
                    A fusion of local ingredients and global techniques.
                </p>
            </div>

            <div class="flex justify-center space-x-2 mb-10 overflow-x-auto pb-4" id="category-filters">
                <button onclick="filterMenu('all')"
                    class="category-btn active px-6 py-2 rounded-full bg-stone-900 text-white text-sm font-medium transition-colors hover:bg-stone-700 whitespace-nowrap">All</button>
                <button onclick="filterMenu('soups')"
                    class="category-btn px-6 py-2 rounded-full bg-stone-100 text-stone-600 text-sm font-medium transition-colors hover:bg-stone-200 whitespace-nowrap">Soups</button>
                <button onclick="filterMenu('starters')"
                    class="category-btn px-6 py-2 rounded-full bg-stone-100 text-stone-600 text-sm font-medium transition-colors hover:bg-stone-200 whitespace-nowrap">Starters</button>
                <button onclick="filterMenu('beef-lamb')"
                    class="category-btn px-6 py-2 rounded-full bg-stone-100 text-stone-600 text-sm font-medium transition-colors hover:bg-stone-200 whitespace-nowrap">Beef &amp; Lamb</button>
                <button onclick="filterMenu('pork')"
                    class="category-btn px-6 py-2 rounded-full bg-stone-100 text-stone-600 text-sm font-medium transition-colors hover:bg-stone-200 whitespace-nowrap">Pork</button>
                <button onclick="filterMenu('chicken')"
                    class="category-btn px-6 py-2 rounded-full bg-stone-100 text-stone-600 text-sm font-medium transition-colors hover:bg-stone-200 whitespace-nowrap">Chicken</button>
                <button onclick="filterMenu('seafood')"
                    class="category-btn px-6 py-2 rounded-full bg-stone-100 text-stone-600 text-sm font-medium transition-colors hover:bg-stone-200 whitespace-nowrap">Seafood</button>
                <button onclick="filterMenu('rice')"
                    class="category-btn px-6 py-2 rounded-full bg-stone-100 text-stone-600 text-sm font-medium transition-colors hover:bg-stone-200 whitespace-nowrap">Rice</button>
                <button onclick="filterMenu('noodles')"
                    class="category-btn px-6 py-2 rounded-full bg-stone-100 text-stone-600 text-sm font-medium transition-colors hover:bg-stone-200 whitespace-nowrap">Noodles</button>
                <button onclick="filterMenu('dumplings')"
                    class="category-btn px-6 py-2 rounded-full bg-stone-100 text-stone-600 text-sm font-medium transition-colors hover:bg-stone-200 whitespace-nowrap">Dumplings</button>
                <button onclick="filterMenu('veg')"
                    class="category-btn px-6 py-2 rounded-full bg-stone-100 text-stone-600 text-sm font-medium transition-colors hover:bg-stone-200 whitespace-nowrap">Vegetable</button>
                <button onclick="filterMenu('mains')"
                    class="category-btn px-6 py-2 rounded-full bg-stone-100 text-stone-600 text-sm font-medium transition-colors hover:bg-stone-200 whitespace-nowrap">Mains</button>
            </div>

            <div class="grid grid-cols-1 gap-y-10 sm:grid-cols-2 gap-x-6 lg:grid-cols-3 xl:gap-x-8" id="menu-container">
            </div>
        </div>
    </section>

    <!-- Reservation Section -->
    <section id="reservation" class="py-16 bg-white border-t border-stone-200">
        <div class="max-w-2xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-12">
                <span class="text-red-700 font-semibold tracking-wide uppercase text-sm">Reserve Your Table</span>
                <h2 class="mt-2 text-3xl leading-8 font-extrabold tracking-tight text-stone-900 sm:text-4xl serif">
                    Make a Reservation
                </h2>
                <p class="mt-4 max-w-2xl text-xl text-stone-500 mx-auto">
                    Book your table in advance for a guaranteed dining experience.
                </p>
            </div>

            <form id="reservation-form" class="space-y-6 bg-stone-50 p-8 rounded-lg shadow-md">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="res-name" class="block text-sm font-medium text-stone-700 mb-2">Full Name *</label>
                        <input type="text" id="res-name" required
                            class="w-full px-4 py-2 border border-stone-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-700 focus:border-transparent">
                    </div>
                    <div>
                        <label for="res-phone" class="block text-sm font-medium text-stone-700 mb-2">Phone Number
                            *</label>
                        <input type="tel" id="res-phone" required
                            class="w-full px-4 py-2 border border-stone-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-700 focus:border-transparent">
                    </div>
                </div>

                <div>
                    <label for="res-email" class="block text-sm font-medium text-stone-700 mb-2">Email</label>
                    <input type="email" id="res-email"
                        class="w-full px-4 py-2 border border-stone-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-700 focus:border-transparent">
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="res-date" class="block text-sm font-medium text-stone-700 mb-2">Date *</label>
                        <input type="date" id="res-date" required
                            class="w-full px-4 py-2 border border-stone-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-700 focus:border-transparent">
                    </div>
                    <div>
                        <label for="res-time" class="block text-sm font-medium text-stone-700 mb-2">Time *</label>
                        <input type="time" id="res-time" required
                            class="w-full px-4 py-2 border border-stone-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-700 focus:border-transparent">
                    </div>
                </div>

                <div>
                    <label for="res-guests" class="block text-sm font-medium text-stone-700 mb-2">Number of Guests
                        *</label>
                    <select id="res-guests" required
                        class="w-full px-4 py-2 border border-stone-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-700 focus:border-transparent">
                        <option value="" disabled selected>Select number of guests</option>
                        <option value="1">1 Guest</option>
                        <option value="2">2 Guests</option>
                        <option value="3">3 Guests</option>
                        <option value="4">4 Guests</option>
                        <option value="5">5 Guests</option>
                        <option value="6">6 Guests</option>
                        <option value="7">7 Guests</option>
                        <option value="8">8+ Guests</option>
                    </select>
                </div>

                <div>
                    <label for="res-notes" class="block text-sm font-medium text-stone-700 mb-2">Special
                        Requests</label>
                    <textarea id="res-notes" rows="3"
                        class="w-full px-4 py-2 border border-stone-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-700 focus:border-transparent"
                        placeholder="Any dietary restrictions or special occasions..."></textarea>
                </div>

                <div id="reservation-error" class="hidden text-red-700 text-sm text-center p-3 bg-red-50 rounded-md">
                </div>

                <button type="submit"
                    class="w-full bg-red-700 text-white py-3 rounded-md hover:bg-red-800 transition-colors font-medium text-lg">
                    Submit Reservation
                </button>
            </form>
        </div>
    </section>

    <!-- My Orders Section -->
    <section id="my-orders" class="py-16 bg-stone-50 border-t border-stone-200 hidden">
        <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-12">
                <span class="text-red-700 font-semibold tracking-wide uppercase text-sm">Order History</span>
                <h2 class="mt-2 text-4xl font-extrabold text-stone-900 serif">My Orders</h2>
                <p class="mt-4 text-lg text-stone-600">Track your orders and their status</p>
            </div>
            
            <div id="orders-container" class="space-y-4">
                <!-- Orders will be dynamically populated here -->
            </div>
            
            <div id="no-orders-message" class="text-center py-12 hidden">
                <i data-lucide="package" class="h-16 w-16 text-stone-300 mx-auto mb-4"></i>
                <p class="text-stone-500 text-lg">You haven't placed any orders yet.</p>
                <a href="#menu" class="inline-block mt-4 px-6 py-2 bg-red-700 text-white rounded-md hover:bg-red-800 transition-colors">Browse Menu</a>
            </div>
        </div>
    </section>

    <section id="location" class="py-16 bg-stone-50 border-t border-stone-200">
        <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-12 items-center">
                <div class="order-2 md:order-1">
                    <h2 class="text-3xl font-extrabold text-stone-900 mb-6 serif">Visit Our Restaurant</h2>
                    <p class="text-stone-600 mb-8 text-lg">
                        Located in the heart of the UCC, our restaurant serves as both a training ground for excellence
                        and a destination for fine dining.
                    </p>

                    <div class="space-y-4">
                        <div class="flex items-start">
                            <i data-lucide="map-pin" class="h-6 w-6 text-red-700 mt-1 mr-4 flex-shrink-0"></i>
                            <div>
                                <h4 class="font-bold text-stone-900">Address</h4>
                                <p class="text-stone-600">Cafe Roof Top<br>Casford Street, UCC</p>
                            </div>
                        </div>
                        <div class="flex items-start">
                            <i data-lucide="clock" class="h-6 w-6 text-red-700 mt-1 mr-4 flex-shrink-0"></i>
                            <div>
                                <h4 class="font-bold text-stone-900">Opening Hours</h4>
                                <p class="text-stone-600">Mon - Fri: 11:00 AM - 5:30 PM<br>Sat - Sun: 12:00 PM - 5:00 PM
                                </p>
                            </div>
                        </div>
                        <div class="flex items-start">
                            <i data-lucide="phone" class="h-6 w-6 text-red-700 mt-1 mr-4 flex-shrink-0"></i>
                            <div>
                                <h4 class="font-bold text-stone-900">Contact</h4>
                                <p class="text-stone-600">020 543 8455<br>reservations@lubanworkshop.com</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="order-1 md:order-2 h-96 bg-stone-200 rounded-2xl overflow-hidden shadow-xl relative">
                    <iframe
                        src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d379.9803273682596!2d-1.2856029509704792!3d5.117627511674501!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0xfddff0037873e8b%3A0xb248c94a61401f0e!2sLuban%20Workshop%20Restaurant!5e0!3m2!1sen!2sgh!4v1771371964579!5m2!1sen!2sgh"
                        width="100%" height="100%" style="border:0;" allowfullscreen="" loading="lazy">
                    </iframe>
                    <div class="absolute bottom-4 right-4 bg-white p-3 rounded-lg shadow-md flex items-center gap-2">
                        <i data-lucide="navigation" class="w-4 h-4 text-blue-600"></i>
                        <a href="https://goo.gl/maps/placeholder" target="_blank"
                            class="text-sm font-bold text-stone-800 hover:text-blue-600">Get Directions</a>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <footer class="bg-stone-900 text-stone-400 py-12">
        <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <div class="flex justify-center items-center mb-6">
                <i data-lucide="utensils-crossed" class="h-6 w-6 text-red-600 mr-2"></i>
                <span class="serif font-bold text-2xl text-white">Luban Workshop</span>
            </div>
            <p class="mb-6">© 2026 Luban Workshop Restaurant. All rights reserved.</p>
            <p class="mb-6 text-sm">For reservations: 020 543 8455</p>
            <div class="flex justify-center space-x-6">
                <a href="#" class="hover:text-white transition-colors"><i data-lucide="facebook"
                        class="h-5 w-5"></i></a>
                <a href="#" class="hover:text-white transition-colors"><i data-lucide="instagram"
                        class="h-5 w-5"></i></a>
                <a href="#" class="hover:text-white transition-colors"><i data-lucide="twitter" class="h-5 w-5"></i></a>
            </div>
        </div>
    </footer>

    <div id="cart-overlay" class="fixed inset-0 bg-stone-900 bg-opacity-50 z-[60] hidden transition-opacity opacity-0"
        onclick="toggleCart()"></div>

    <div id="cart-drawer" class="fixed inset-y-0 right-0 max-w-full flex z-[70] pointer-events-none">
        <div class="w-screen max-w-md pointer-events-auto transform transition ease-in-out duration-300 translate-x-full bg-white shadow-xl flex flex-col h-full"
            id="cart-panel">
            <div class="flex-1 overflow-y-auto py-6 px-4 sm:px-6">
                <div class="flex items-start justify-between">
                    <h2 class="text-lg font-medium text-stone-900 serif">Your Order</h2>
                    <div class="ml-3 h-7 flex items-center">
                        <button onclick="toggleCart()" class="-m-2 p-2 text-stone-400 hover:text-stone-500">
                            <span class="sr-only">Close panel</span>
                            <i data-lucide="x" class="h-6 w-6"></i>
                        </button>
                    </div>
                </div>

                <div class="mt-8">
                    <div class="flow-root">
                        <ul id="cart-items" role="list" class="-my-6 divide-y divide-stone-200">
                            <li id="empty-cart-msg" class="py-6 text-center text-stone-500 italic">
                                Your cart is empty. <br> Start adding some delicious dishes!
                            </li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="border-t border-stone-200 py-6 px-4 sm:px-6 bg-stone-50">
                <div class="flex justify-between text-base font-medium text-stone-900 mb-4">
                    <p>Subtotal</p>
                    <p id="cart-total">₵0.00</p>
                </div>
                <p class="mt-0.5 text-sm text-stone-500 mb-6">Pay at counter upon pickup.</p>
                <div class="space-y-3">
                    <button onclick="checkout()" id="checkout-btn"
                        class="w-full flex justify-center items-center px-6 py-3 border border-transparent rounded-md shadow-sm text-base font-medium text-white bg-red-700 hover:bg-red-800 disabled:opacity-50 disabled:cursor-not-allowed transition-colors">
                        Place Order
                    </button>
                    <button onclick="toggleCart()"
                        class="w-full flex justify-center items-center px-6 py-3 border border-stone-300 rounded-md shadow-sm text-base font-medium text-stone-700 bg-white hover:bg-stone-50 transition-colors">
                        Continue Ordering
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="success-modal" class="fixed inset-0 z-[80] overflow-y-auto hidden" aria-labelledby="modal-title"
        role="dialog" aria-modal="true">
        <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <div class="fixed inset-0 bg-stone-500 bg-opacity-75 transition-opacity" aria-hidden="true"></div>
            <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">​</span>
            <div
                class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-sm sm:w-full">
                <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                    <div class="sm:flex sm:items-start">
                        <div
                            class="mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-green-100 sm:mx-0 sm:h-10 sm:w-10">
                            <i data-lucide="check" class="h-6 w-6 text-green-600"></i>
                        </div>
                        <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left">
                            <h3 class="text-lg leading-6 font-medium text-stone-900" id="modal-title">Order Received!
                            </h3>
                            <div class="mt-2">
                                <p class="text-sm text-stone-500">
                                    Your order has been sent to the kitchen. Please proceed to the counter for payment.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="bg-stone-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                    <button type="button" onclick="closeSuccessModal()"
                        class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-green-600 text-base font-medium text-white hover:bg-green-700 focus:outline-none sm:ml-3 sm:w-auto sm:text-sm">
                        Got it
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Auth Modal -->
    <div id="auth-modal" class="fixed inset-0 z-[80] overflow-y-auto hidden" aria-labelledby="auth-modal-title"
        role="dialog" aria-modal="true">
        <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <div class="fixed inset-0 bg-stone-500 bg-opacity-75 transition-opacity" aria-hidden="true"
                onclick="toggleAuthModal()"></div>
            <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">​</span>
            <div
                class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-md sm:w-full">
                <div class="bg-white px-4 pt-5 pb-4 sm:p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-2xl font-bold text-stone-900 serif" id="auth-modal-title">Sign Up / Login</h3>
                        <button onclick="toggleAuthModal()" class="text-stone-400 hover:text-stone-500">
                            <i data-lucide="x" class="h-6 w-6"></i>
                        </button>
                    </div>

                    <!-- Tab Navigation -->
                    <div class="flex border-b border-stone-200 mb-6">
                        <button id="login-tab" onclick="switchAuthTab('login')"
                            class="flex-1 py-2 text-center font-medium border-b-2 border-red-700 text-red-700">
                            Login
                        </button>
                        <button id="signup-tab" onclick="switchAuthTab('signup')"
                            class="flex-1 py-2 text-center font-medium border-b-2 border-transparent text-stone-500 hover:text-stone-700">
                            Sign Up
                        </button>
                    </div>

                    <!-- Login Form -->
                    <form id="login-form-modal" class="space-y-4">
                        <div>
                            <label for="login-email" class="block text-sm font-medium text-stone-700 mb-2">Email</label>
                            <input type="email" id="login-email" required
                                class="w-full px-4 py-2 border border-stone-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-700 focus:border-transparent">
                        </div>
                        <div>
                            <label for="login-password"
                                class="block text-sm font-medium text-stone-700 mb-2">Password</label>
                            <input type="password" id="login-password" required
                                class="w-full px-4 py-2 border border-stone-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-700 focus:border-transparent">
                        </div>
                        <div id="login-error-modal" class="hidden text-red-700 text-sm p-3 bg-red-50 rounded-md"></div>
                        <button type="submit"
                            class="w-full bg-red-700 text-white py-2 rounded-md hover:bg-red-800 transition-colors font-medium">
                            Login
                        </button>
                    </form>

                    <!-- Signup Form -->
                    <form id="signup-form-modal" class="space-y-4 hidden">
                        <div>
                            <label for="signup-email"
                                class="block text-sm font-medium text-stone-700 mb-2">Email</label>
                            <input type="email" id="signup-email" required
                                class="w-full px-4 py-2 border border-stone-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-700 focus:border-transparent">
                        </div>
                        <div>
                            <label for="signup-password"
                                class="block text-sm font-medium text-stone-700 mb-2">Password</label>
                            <input type="password" id="signup-password" required minlength="6"
                                class="w-full px-4 py-2 border border-stone-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-700 focus:border-transparent">
                            <p class="text-xs text-stone-500 mt-1">At least 6 characters</p>
                        </div>
                        <div>
                            <label for="signup-password-confirm"
                                class="block text-sm font-medium text-stone-700 mb-2">Confirm Password</label>
                            <input type="password" id="signup-password-confirm" required minlength="6"
                                class="w-full px-4 py-2 border border-stone-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-700 focus:border-transparent">
                        </div>
                        <div id="signup-error-modal" class="hidden text-red-700 text-sm p-3 bg-red-50 rounded-md"></div>
                        <button type="submit"
                            class="w-full bg-red-700 text-white py-2 rounded-md hover:bg-red-800 transition-colors font-medium">
                            Sign Up
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Reservation Success Modal -->
    <div id="reservation-success-modal" class="fixed inset-0 z-[80] overflow-y-auto hidden"
        aria-labelledby="res-modal-title" role="dialog" aria-modal="true">
        <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <div class="fixed inset-0 bg-stone-500 bg-opacity-75 transition-opacity" aria-hidden="true"></div>
            <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">​</span>
            <div
                class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-sm sm:w-full">
                <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                    <div class="sm:flex sm:items-start">
                        <div
                            class="mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-green-100 sm:mx-0 sm:h-10 sm:w-10">
                            <i data-lucide="check" class="h-6 w-6 text-green-600"></i>
                        </div>
                        <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left">
                            <h3 class="text-lg leading-6 font-medium text-stone-900" id="res-modal-title">Reservation
                                Confirmed!</h3>
                            <div class="mt-2">
                                <p class="text-sm text-stone-500">
                                    Your table has been reserved. We'll send you a confirmation email shortly.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="bg-stone-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                    <button type="button" onclick="closeReservationModal()"
                        class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-green-600 text-base font-medium text-white hover:bg-green-700 focus:outline-none sm:ml-3 sm:w-auto sm:text-sm">
                        Got it
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize Icons
        lucide.createIcons();

        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDxgdwU84vFNoCOUTl-HRdGYonLIcDaXFw",
            authDomain: "luban-workshop-restaurant.firebaseapp.com",
            projectId: "luban-workshop-restaurant",
            storageBucket: "luban-workshop-restaurant.firebasestorage.app",
            messagingSenderId: "360623290287",
            appId: "1:360623290287:web:89fae5ebbb342e5e13e15a",
            measurementId: "G-PZQ13BWZB3"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // --- Hardcoded Dishes ---
        const DISHES = [
            { id: 'SP1', name: 'Chicken & Sweet Corn Soup', category: 'soups', price: 40, description: 'A smooth, savoury broth with tender chicken and sweet corn', image: 'https://images.unsplash.com/photo-1547592166-23ac45744acd?w=600&h=400&fit=crop&auto=format' },
            { id: 'SP2', name: 'Hot & Sour Soup', category: 'soups', price: 40, description: 'Traditional Chinese hot and sour broth with tofu and vegetables', image: 'https://images.unsplash.com/photo-1555126634-323283e090fa?w=600&h=400&fit=crop&auto=format' },
            { id: 'S1', name: 'Beef Spring Rolls (3 pcs)', category: 'starters', price: 30, description: 'Crispy golden beef spring rolls', image: 'https://images.unsplash.com/photo-1606525437394-f0b0df43c5e0?w=600&h=400&fit=crop&auto=format' },
            { id: 'S2', name: 'Vegetable Spring Rolls (3 pcs)', category: 'starters', price: 25, description: 'Crispy golden vegetable spring rolls', image: 'https://images.unsplash.com/photo-1563245372-f89ffd94b5eb?w=600&h=400&fit=crop&auto=format' },
            { id: 'S3', name: 'Beef Samosa (5 pcs)', category: 'starters', price: 30, description: 'Golden fried beef samosas', image: 'https://images.unsplash.com/photo-1601050690597-df0568f70950?w=600&h=400&fit=crop&auto=format' },
            { id: 'S4', name: 'Fish Samosa (5 pcs)', category: 'starters', price: 30, description: 'Golden fried fish samosas', image: 'https://images.unsplash.com/photo-1601050690597-df0568f70950?w=600&h=400&fit=crop&auto=format' },
            { id: 'S5', name: 'Fried Chicken Pieces (6 pcs)', category: 'starters', price: 65, description: 'Crispy fried chicken pieces', image: 'https://images.unsplash.com/photo-1562967915-6ba607ff4a08?w=600&h=400&fit=crop&auto=format' },
            { id: 'S6', name: 'Special Chicken Wings', category: 'starters', price: 65, description: 'Special marinated chicken wings', image: 'https://images.unsplash.com/photo-1527477396000-e27163b481c2?w=600&h=400&fit=crop&auto=format' },
            { id: 'S7', name: 'Golden Fried Prawns', category: 'starters', price: 90, description: 'Crispy golden fried prawns', image: 'https://images.unsplash.com/photo-1559410545-0bdb565a7e6b?w=600&h=400&fit=crop&auto=format' },
            { id: 'S8', name: 'Fried Squid in Spicy Salt', category: 'starters', price: 85, description: 'Tender squid tossed in spicy salt', image: 'https://images.unsplash.com/photo-1617622141573-0e6db8c3dc7a?w=600&h=400&fit=crop&auto=format' },
            { id: 'B1', name: 'Shredded Beef with Green Pepper & Onion', category: 'beef-lamb', price: 110, description: 'Shredded beef in sauce with green pepper and onion', image: 'https://images.unsplash.com/photo-1529193591-8c9ae9699b13?w=600&h=400&fit=crop&auto=format' },
            { id: 'B2', name: 'Beef in Sichuan Sauce', category: 'beef-lamb', price: 110, description: 'Tender beef in authentic Sichuan sauce', image: 'https://images.unsplash.com/photo-1547592180-85f173990554?w=600&h=400&fit=crop&auto=format' },
            { id: 'B3', name: 'Sliced Beef in Curry Sauce', category: 'beef-lamb', price: 110, description: 'Sliced beef in rich curry sauce', image: 'https://images.unsplash.com/photo-1455619452474-d2be8b1e70cd?w=600&h=400&fit=crop&auto=format' },
            { id: 'B4', name: 'Beef in Oyster Sauce', category: 'beef-lamb', price: 110, description: 'Beef in savoury oyster sauce', image: 'https://images.unsplash.com/photo-1529193591-8c9ae9699b13?w=600&h=400&fit=crop&auto=format' },
            { id: 'B5', name: 'Crispy Chilli Beef', category: 'beef-lamb', price: 85, description: 'Crispy beef with a sweet chilli glaze', image: 'https://images.unsplash.com/photo-1562967916-eb82221dfb92?w=600&h=400&fit=crop&auto=format' },
            { id: 'B6', name: 'Mongolian Shallot Lamb', category: 'beef-lamb', price: 115, description: 'Tender lamb with shallots Mongolian style', image: 'https://images.unsplash.com/photo-1544025162-d76694265947?w=600&h=400&fit=crop&auto=format' },
            { id: 'B7', name: 'Lamb Chops', category: 'beef-lamb', price: 85, description: 'Grilled lamb chops', image: 'https://images.unsplash.com/photo-1544025162-d76694265947?w=600&h=400&fit=crop&auto=format' },
            { id: 'P1', name: 'Sweet & Sour Pork', category: 'pork', price: 90, description: 'Classic sweet and sour pork', image: 'https://images.unsplash.com/photo-1574484284002-952d92456975?w=600&h=400&fit=crop&auto=format' },
            { id: 'P2', name: 'Pork Sichuan Style', category: 'pork', price: 90, description: 'Pork in spicy Sichuan sauce', image: 'https://images.unsplash.com/photo-1547592180-85f173990554?w=600&h=400&fit=crop&auto=format' },
            { id: 'P3', name: 'Pork in Chilli Sauce', category: 'pork', price: 90, description: 'Pork in rich chilli sauce', image: 'https://images.unsplash.com/photo-1563379926898-05f4575a45d8?w=600&h=400&fit=crop&auto=format' },
            { id: 'P4', name: 'Pork in Oyster Sauce', category: 'pork', price: 90, description: 'Pork in savoury oyster sauce', image: 'https://images.unsplash.com/photo-1529193591-8c9ae9699b13?w=600&h=400&fit=crop&auto=format' },
            { id: 'P5', name: 'Fried Pork Ribs', category: 'pork', price: 75, description: 'Crispy fried pork ribs', image: 'https://images.unsplash.com/photo-1544025162-d76694265947?w=600&h=400&fit=crop&auto=format' },
            { id: 'K1', name: 'Sweet & Sour Chicken', category: 'chicken', price: 100, description: 'Classic sweet and sour chicken', image: 'https://images.unsplash.com/photo-1574484284002-952d92456975?w=600&h=400&fit=crop&auto=format' },
            { id: 'K2', name: 'Chicken Sichuan Sauce', category: 'chicken', price: 100, description: 'Chicken in Sichuan sauce', image: 'https://images.unsplash.com/photo-1604908176997-7f81f85f7c8e?w=600&h=400&fit=crop&auto=format' },
            { id: 'K3', name: 'Chicken in Curry Sauce', category: 'chicken', price: 100, description: 'Chicken in curry sauce', image: 'https://images.unsplash.com/photo-1455619452474-d2be8b1e70cd?w=600&h=400&fit=crop&auto=format' },
            { id: 'K4', name: 'Chicken in Oyster Sauce', category: 'chicken', price: 100, description: 'Chicken in oyster sauce', image: 'https://images.unsplash.com/photo-1562967915-6ba607ff4a08?w=600&h=400&fit=crop&auto=format' },
            { id: 'Q1', name: 'Squid in Luban Chilli Sauce', category: 'seafood', price: 120, description: 'Squid in our signature Luban chilli sauce', image: 'https://images.unsplash.com/photo-1617622141573-0e6db8c3dc7a?w=600&h=400&fit=crop&auto=format' },
            { id: 'Q2', name: 'Squid in Sichuan Sauce', category: 'seafood', price: 120, description: 'Squid in Sichuan sauce', image: 'https://images.unsplash.com/photo-1617622141573-0e6db8c3dc7a?w=600&h=400&fit=crop&auto=format' },
            { id: 'Q3', name: 'Squid in Garlic Sauce', category: 'seafood', price: 120, description: 'Squid in garlic sauce', image: 'https://images.unsplash.com/photo-1617622141573-0e6db8c3dc7a?w=600&h=400&fit=crop&auto=format' },
            { id: 'F1', name: 'Fish Fillet in Chilli Sauce', category: 'seafood', price: 115, description: 'Fish fillet in chilli sauce', image: 'https://images.unsplash.com/photo-1580476262798-bddd9f4b7369?w=600&h=400&fit=crop&auto=format' },
            { id: 'F2', name: 'Fish Fillet in Vegetable Sauce', category: 'seafood', price: 115, description: 'Fish fillet in vegetable sauce', image: 'https://images.unsplash.com/photo-1580476262798-bddd9f4b7369?w=600&h=400&fit=crop&auto=format' },
            { id: 'F3', name: 'Fish Fillet in Sichuan Sauce', category: 'seafood', price: 115, description: 'Fish fillet in Sichuan sauce', image: 'https://images.unsplash.com/photo-1580476262798-bddd9f4b7369?w=600&h=400&fit=crop&auto=format' },
            { id: 'F4', name: 'Sweet & Sour Fish Fillet', category: 'seafood', price: 115, description: 'Sweet and sour fish fillet', image: 'https://images.unsplash.com/photo-1580476262798-bddd9f4b7369?w=600&h=400&fit=crop&auto=format' },
            { id: 'PR1', name: 'Prawns in Chilli Sauce', category: 'seafood', price: 155, description: 'Prawns in chilli sauce', image: 'https://images.unsplash.com/photo-1559410545-0bdb565a7e6b?w=600&h=400&fit=crop&auto=format' },
            { id: 'PR2', name: 'Prawns in Curry Sauce', category: 'seafood', price: 155, description: 'Prawns in curry sauce', image: 'https://images.unsplash.com/photo-1559410545-0bdb565a7e6b?w=600&h=400&fit=crop&auto=format' },
            { id: 'PR3', name: 'Prawns in Sichuan Sauce', category: 'seafood', price: 155, description: 'Prawns in Sichuan sauce', image: 'https://images.unsplash.com/photo-1559410545-0bdb565a7e6b?w=600&h=400&fit=crop&auto=format' },
            { id: 'SF1', name: 'Special Seafood in Sichuan Sauce', category: 'seafood', price: 170, description: 'Special mixed seafood in Sichuan sauce', image: 'https://images.unsplash.com/photo-1559410545-0bdb565a7e6b?w=600&h=400&fit=crop&auto=format' },
            { id: 'R1', name: 'Steamed Rice', category: 'rice', price: 29, description: 'Freshly steamed white rice', image: 'https://images.unsplash.com/photo-1603133872634-6e01db44284e?w=600&h=400&fit=crop&auto=format' },
            { id: 'R2', name: 'Special Jollof Rice', category: 'rice', price: 50, description: 'West African style jollof rice', image: 'https://images.unsplash.com/photo-1596560548464-f010549b84d7?w=600&h=400&fit=crop&auto=format' },
            { id: 'R3', name: 'Combo Fried Rice', category: 'rice', price: 50, description: 'Mixed combo fried rice', image: 'https://images.unsplash.com/photo-1603133872634-6e01db44284e?w=600&h=400&fit=crop&auto=format' },
            { id: 'R4', name: 'Shrimp Fried Rice', category: 'rice', price: 50, description: 'Fried rice with shrimp', image: 'https://images.unsplash.com/photo-1603133872634-6e01db44284e?w=600&h=400&fit=crop&auto=format' },
            { id: 'RS', name: 'Egg Fried Rice', category: 'rice', price: 40, description: 'Classic egg fried rice', image: 'https://images.unsplash.com/photo-1609501676725-7186f017a4b7?w=600&h=400&fit=crop&auto=format' },
            { id: 'R6', name: 'Beef Fried Rice', category: 'rice', price: 45, description: 'Fried rice with beef', image: 'https://images.unsplash.com/photo-1603133872634-6e01db44284e?w=600&h=400&fit=crop&auto=format' },
            { id: 'R7', name: 'Chicken Fried Rice', category: 'rice', price: 45, description: 'Fried rice with chicken', image: 'https://images.unsplash.com/photo-1603133872634-6e01db44284e?w=600&h=400&fit=crop&auto=format' },
            { id: 'R8', name: 'Seafood Fried Rice', category: 'rice', price: 85, description: 'Fried rice with mixed seafood', image: 'https://images.unsplash.com/photo-1603133872634-6e01db44284e?w=600&h=400&fit=crop&auto=format' },
            { id: 'R9', name: 'Pork Fried Rice', category: 'rice', price: 45, description: 'Fried rice with pork', image: 'https://images.unsplash.com/photo-1603133872634-6e01db44284e?w=600&h=400&fit=crop&auto=format' },
            { id: 'N1', name: 'Vegetable Noodles', category: 'noodles', price: 45, description: 'Wok-tossed noodles with vegetables', image: 'https://images.unsplash.com/photo-1557872943-16a5ac26437e?w=600&h=400&fit=crop&auto=format' },
            { id: 'N2', name: 'Special Noodles', category: 'noodles', price: 80, description: 'Special Luban noodles', image: 'https://images.unsplash.com/photo-1557872943-16a5ac26437e?w=600&h=400&fit=crop&auto=format' },
            { id: 'N4', name: 'Singapore Noodles', category: 'noodles', price: 80, description: 'Singapore style noodles', image: 'https://images.unsplash.com/photo-1567529692333-de9fd6772897?w=600&h=400&fit=crop&auto=format' },
            { id: 'N5', name: 'Seafood Noodles', category: 'noodles', price: 100, description: 'Noodles with mixed seafood', image: 'https://images.unsplash.com/photo-1557872943-16a5ac26437e?w=600&h=400&fit=crop&auto=format' },
            { id: 'N6', name: 'Chicken Noodles', category: 'noodles', price: 60, description: 'Noodles with chicken', image: 'https://images.unsplash.com/photo-1557872943-16a5ac26437e?w=600&h=400&fit=crop&auto=format' },
            { id: 'D1', name: 'Steamed Pork Dumpling', category: 'dumplings', price: 30, description: 'Handcrafted steamed pork dumplings', image: 'https://images.unsplash.com/photo-1563245372-f89ffd94b5eb?w=600&h=400&fit=crop&auto=format' },
            { id: 'D2', name: 'Fried Pork Dumpling', category: 'dumplings', price: 30, description: 'Crispy fried pork dumplings', image: 'https://images.unsplash.com/photo-1563245372-f89ffd94b5eb?w=600&h=400&fit=crop&auto=format' },
            { id: 'D3', name: 'Steamed Beef Dumpling', category: 'dumplings', price: 30, description: 'Handcrafted steamed beef dumplings', image: 'https://images.unsplash.com/photo-1563245372-f89ffd94b5eb?w=600&h=400&fit=crop&auto=format' },
            { id: 'D4', name: 'Fried Beef Dumpling', category: 'dumplings', price: 30, description: 'Crispy fried beef dumplings', image: 'https://images.unsplash.com/photo-1563245372-f89ffd94b5eb?w=600&h=400&fit=crop&auto=format' },
            { id: 'V1', name: 'Mixed Vegetable Sauce', category: 'veg', price: 40, description: 'Fresh mixed vegetables in sauce', image: 'https://images.unsplash.com/photo-1512621776951-a57141f2eefd?w=600&h=400&fit=crop&auto=format' },
        ];

        // Global variables
        let menuItems = [];
        let cart = [];
        let currentUser = null; // NEW: Track the logged-in user

        // --- Firebase Auth State Observer ---
        auth.onAuthStateChanged(user => {
            currentUser = user; // Store user for checkout

            const authBtnDesktop = document.getElementById('auth-btn-desktop');
            const authBtnMobile = document.getElementById('auth-btn-mobile');
            const userInfoDesktop = document.getElementById('user-info-desktop');
            const userInfoMobile = document.getElementById('user-info-mobile');
            const myOrdersLinkDesktop = document.getElementById('my-orders-link-desktop');
            const myOrdersLinkMobile = document.getElementById('my-orders-link-mobile');
            const myOrdersSection = document.getElementById('my-orders');

            if (user) {
                // User is signed in
                authBtnDesktop.classList.add('hidden');
                authBtnMobile.classList.add('hidden');
                userInfoDesktop.classList.remove('hidden');
                userInfoDesktop.classList.add('flex');
                userInfoMobile.classList.remove('hidden');
                myOrdersLinkDesktop.classList.remove('hidden');
                myOrdersLinkMobile.classList.remove('hidden');
                myOrdersLinkMobile.classList.add('block');
                myOrdersSection.classList.remove('hidden');

                const emailPrefix = user.email.split('@')[0];
                document.getElementById('user-email-desktop').textContent = emailPrefix;
                document.getElementById('user-email-mobile').textContent = emailPrefix;
                
                // Load user's orders
                loadMyOrders(user);
                listenToMyOrders(user);
            } else {
                // User is signed out
                authBtnDesktop.classList.remove('hidden');
                authBtnMobile.classList.remove('hidden');
                userInfoDesktop.classList.add('hidden');
                userInfoMobile.classList.add('hidden');
                myOrdersLinkDesktop.classList.add('hidden');
                myOrdersLinkMobile.classList.add('hidden');
                myOrdersLinkMobile.classList.remove('block');
                myOrdersSection.classList.add('hidden');
            }
            lucide.createIcons();
        });

        // --- Listen to Dish Availability ---
        function listenToAvailability() {
            db.collection('settings').doc('menuAvailability').onSnapshot(doc => {
                const hiddenIds = (doc.exists && doc.data().hiddenDishIds) ? doc.data().hiddenDishIds : [];
                menuItems = DISHES.filter(dish => !hiddenIds.includes(dish.id));
                renderMenu();
            }, (error) => {
                console.error('Error fetching menu availability:', error);
                menuItems = DISHES.slice();
                renderMenu();
            });
        }

        // --- Auth Functions (Login/Signup/Logout) ---
        function toggleAuthModal() {
            const modal = document.getElementById('auth-modal');
            modal.classList.toggle('hidden');
            lucide.createIcons();
        }

        function switchAuthTab(tab) {
            const loginTab = document.getElementById('login-tab');
            const signupTab = document.getElementById('signup-tab');
            const loginForm = document.getElementById('login-form-modal');
            const signupForm = document.getElementById('signup-form-modal');

            if (tab === 'login') {
                loginTab.classList.add('border-red-700', 'text-red-700');
                loginTab.classList.remove('border-transparent', 'text-stone-500');
                signupTab.classList.remove('border-red-700', 'text-red-700');
                signupTab.classList.add('border-transparent', 'text-stone-500');
                loginForm.classList.remove('hidden');
                signupForm.classList.add('hidden');
            } else {
                signupTab.classList.add('border-red-700', 'text-red-700');
                signupTab.classList.remove('border-transparent', 'text-stone-500');
                loginTab.classList.remove('border-red-700', 'text-red-700');
                loginTab.classList.add('border-transparent', 'text-stone-500');
                signupForm.classList.remove('hidden');
                loginForm.classList.add('hidden');
            }
        }

        document.getElementById('login-form-modal').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            const errorDiv = document.getElementById('login-error-modal');

            try {
                await auth.signInWithEmailAndPassword(email, password);
                toggleAuthModal();
                errorDiv.classList.add('hidden');
                document.getElementById('login-form-modal').reset();
            } catch (error) {
                errorDiv.textContent = error.message;
                errorDiv.classList.remove('hidden');
            }
        });

        document.getElementById('signup-form-modal').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('signup-email').value;
            const password = document.getElementById('signup-password').value;
            const confirmPassword = document.getElementById('signup-password-confirm').value;
            const errorDiv = document.getElementById('signup-error-modal');

            if (password !== confirmPassword) {
                errorDiv.textContent = 'Passwords do not match';
                errorDiv.classList.remove('hidden');
                return;
            }

            try {
                await auth.createUserWithEmailAndPassword(email, password);
                toggleAuthModal();
                errorDiv.classList.add('hidden');
                document.getElementById('signup-form-modal').reset();
            } catch (error) {
                errorDiv.textContent = error.message;
                errorDiv.classList.remove('hidden');
            }
        });

        function logout() {
            auth.signOut();
        }

        // --- Reservation Logic ---
        document.getElementById('reservation-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const errorDiv = document.getElementById('reservation-error');

            const selectedDate = new Date(document.getElementById('res-date').value);
            const today = new Date();
            today.setHours(0, 0, 0, 0);

            if (selectedDate < today) {
                errorDiv.textContent = 'Please select a date in the future.';
                errorDiv.classList.remove('hidden');
                return;
            }

            const reservationData = {
                name: document.getElementById('res-name').value,
                phone: document.getElementById('res-phone').value,
                email: document.getElementById('res-email').value,
                date: document.getElementById('res-date').value,
                time: document.getElementById('res-time').value,
                guests: document.getElementById('res-guests').value,
                notes: document.getElementById('res-notes').value,
                createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                status: 'pending'
            };

            try {
                await db.collection('reservations').add(reservationData);
                document.getElementById('reservation-success-modal').classList.remove('hidden');
                document.getElementById('reservation-form').reset();
                errorDiv.classList.add('hidden');
            } catch (error) {
                console.error('Error saving reservation:', error);
                errorDiv.textContent = 'Failed to submit reservation.';
                errorDiv.classList.remove('hidden');
            }
        });

        function closeReservationModal() {
            document.getElementById('reservation-success-modal').classList.add('hidden');
        }

        // --- Menu & Cart Logic ---
        function renderMenu(filter = 'all') {
            const container = document.getElementById('menu-container');
            container.innerHTML = '';
            const items = filter === 'all' ? menuItems : menuItems.filter(item => item.category === filter);

            items.forEach(item => {
                const card = document.createElement('div');
                card.className = 'group relative bg-white border border-stone-100 rounded-xl shadow-sm overflow-hidden hover:shadow-lg transition-all duration-300 fade-in flex flex-col h-full';
                card.innerHTML = `
                <div class="aspect-w-4 aspect-h-3 bg-stone-200 overflow-hidden relative">
                    <img src="${item.image}" alt="${item.name}" onerror="this.src='https://placehold.co/600x400/e5e5e5/a3a3a3?text=No+Image'" class="w-full h-60 object-cover transform group-hover:scale-105 transition-transform duration-500">
                    <div class="absolute top-2 right-2 bg-white/90 backdrop-blur px-2 py-1 rounded-md text-sm font-bold text-stone-900 shadow-sm">₵${item.price.toFixed(2)}</div>
                </div>
                <div class="p-6 flex flex-col flex-1">
                    <h3 class="text-lg font-bold text-stone-900 serif group-hover:text-red-700 transition-colors">${item.name}</h3>
                    <p class="mt-2 text-sm text-stone-500 line-clamp-2 flex-1">${item.description}</p>
                    <div class="mt-6">
                        <button onclick="addToCart('${item.id}')" class="w-full flex justify-center items-center px-4 py-2 border border-transparent rounded-lg shadow-sm text-sm font-medium text-white bg-stone-900 hover:bg-stone-800 transition-colors">
                            <i data-lucide="plus" class="w-4 h-4 mr-2"></i> Add to Order
                        </button>
                    </div>
                </div>`;
                container.appendChild(card);
            });
            lucide.createIcons();
        }

        function filterMenu(category) {
            document.querySelectorAll('.category-btn').forEach(btn => {
                const btnText = btn.textContent.toLowerCase();
                if ((category === 'all' && btnText === 'all') || btnText.includes(category)) {
                    btn.classList.remove('bg-stone-100', 'text-stone-600');
                    btn.classList.add('bg-stone-900', 'text-white');
                } else {
                    btn.classList.remove('bg-stone-900', 'text-white');
                    btn.classList.add('bg-stone-100', 'text-stone-600');
                }
            });
            renderMenu(category);
        }

        function addToCart(id) {
            const item = menuItems.find(i => i.id === id);
            const existingItem = cart.find(i => i.id === id);
            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                cart.push({ ...item, quantity: 1 });
            }
            updateCartUI();
            const badgeDesktop = document.getElementById('cart-badge-desktop');
            const badgeMobile = document.getElementById('cart-badge-mobile');
            [badgeDesktop, badgeMobile].forEach(el => {
                el.classList.add('scale-125');
                setTimeout(() => el.classList.remove('scale-125'), 200);
            });
        }

        function removeFromCart(id) {
            const index = cart.findIndex(i => i.id === id); // Fix: Use string ID comparison
            if (index > -1) {
                if (cart[index].quantity > 1) {
                    cart[index].quantity -= 1;
                } else {
                    cart.splice(index, 1);
                }
            }
            updateCartUI();
        }

        function updateCartUI() {
            const cartList = document.getElementById('cart-items');
            const totalEl = document.getElementById('cart-total');
            const badgeDesktop = document.getElementById('cart-badge-desktop');
            const badgeMobile = document.getElementById('cart-badge-mobile');
            const checkoutBtn = document.getElementById('checkout-btn');

            const count = cart.reduce((sum, item) => sum + item.quantity, 0);
            badgeDesktop.innerText = count;
            badgeMobile.innerText = count;

            if (count > 0) {
                badgeDesktop.classList.remove('hidden');
                badgeMobile.classList.remove('hidden');
                checkoutBtn.disabled = false;
            } else {
                badgeDesktop.classList.add('hidden');
                badgeMobile.classList.add('hidden');
                checkoutBtn.disabled = true;
            }

            cartList.innerHTML = '';
            if (cart.length === 0) {
                cartList.innerHTML = `<li class="py-12 text-center flex flex-col items-center text-stone-500"><i data-lucide="shopping-basket" class="w-12 h-12 mb-4 text-stone-300"></i><p class="text-lg font-medium">Your cart is empty</p></li>`;
            } else {
                let subtotal = 0;
                cart.forEach(item => {
                    subtotal += item.price * item.quantity;
                    const li = document.createElement('li');
                    li.className = 'py-6 flex';
                    li.innerHTML = `
                    <div class="flex-shrink-0 w-20 h-20 border border-stone-200 rounded-md overflow-hidden">
                        <img src="${item.image}" class="w-full h-full object-center object-cover">
                    </div>
                    <div class="ml-4 flex-1 flex flex-col">
                        <div class="flex justify-between text-base font-medium text-stone-900">
                            <h3>${item.name}</h3>
                            <p class="ml-4">₵${(item.price * item.quantity).toFixed(2)}</p>
                        </div>
                        <p class="mt-1 text-sm text-stone-500">₵${item.price.toFixed(2)} each</p>
                        <div class="flex-1 flex items-end justify-between text-sm">
                            <div class="flex items-center border border-stone-300 rounded-md">
                                <button onclick="removeFromCart('${item.id}')" class="px-2 py-1 hover:bg-stone-100">-</button>
                                <span class="px-2 font-medium">${item.quantity}</span>
                                <button onclick="addToCart('${item.id}')" class="px-2 py-1 hover:bg-stone-100">+</button>
                            </div>
                        </div>
                    </div>`;
                    cartList.appendChild(li);
                });
                totalEl.innerText = '₵' + subtotal.toFixed(2);
            }
            lucide.createIcons();
        }

        function toggleCart() {
            const overlay = document.getElementById('cart-overlay');
            const drawer = document.getElementById('cart-panel');
            if (overlay.classList.contains('hidden')) {
                overlay.classList.remove('hidden');
                setTimeout(() => overlay.classList.remove('opacity-0'), 10);
                drawer.classList.remove('translate-x-full');
            } else {
                overlay.classList.add('opacity-0');
                drawer.classList.add('translate-x-full');
                setTimeout(() => overlay.classList.add('hidden'), 300);
            }
        }

        function closeSuccessModal() {
            document.getElementById('success-modal').classList.add('hidden');
        }

        // --- Paste this into your Main Website Script ---

        let previousStatusMap = {}; // To track changes so we don't alert twice

        function listenToMyOrders(user) {
            if (!user) return;

            // Listen for orders created by this user
            db.collection('orders')
                .where('userId', '==', user.uid)
                .orderBy('createdAt', 'desc')
                .limit(5)
                .onSnapshot(snapshot => {
                    snapshot.forEach(doc => {
                        const order = doc.data();
                        const orderId = doc.id;

                        // If we tracked this order before, and status changed to completed
                        if (previousStatusMap[orderId] === 'pending' && order.status === 'completed') {
                            alert(`Your order #${orderId.slice(-6).toUpperCase()} is ready for pickup!`);
                        }

                        // Update our tracker
                        previousStatusMap[orderId] = order.status;
                    });
                });
        }

        // Load and display user's orders
        function loadMyOrders(user) {
            if (!user) return;

            const ordersContainer = document.getElementById('orders-container');
            const noOrdersMessage = document.getElementById('no-orders-message');
            
            db.collection('orders')
                .where('userId', '==', user.uid)
                .orderBy('createdAt', 'desc')
                .onSnapshot(snapshot => {
                    ordersContainer.innerHTML = '';
                    
                    if (snapshot.empty) {
                        noOrdersMessage.classList.remove('hidden');
                        ordersContainer.classList.add('hidden');
                        return;
                    }
                    
                    noOrdersMessage.classList.add('hidden');
                    ordersContainer.classList.remove('hidden');
                    
                    snapshot.forEach(doc => {
                        const order = doc.data();
                        const orderId = doc.id;
                        
                        // Calculate time elapsed since order creation
                        const canCancel = canCancelOrder(order.createdAt);
                        
                        // Determine status colors
                        let statusClass = 'bg-stone-100 text-stone-800';
                        if (order.status === 'completed') statusClass = 'bg-green-100 text-green-800';
                        if (order.status === 'pending') statusClass = 'bg-yellow-100 text-yellow-800';
                        if (order.status === 'cancelled') statusClass = 'bg-red-100 text-red-800';
                        
                        // Format items
                        const itemsList = order.items ? order.items.map(item => 
                            `<li class="text-stone-600">${item.quantity}x ${item.name} - $${(item.price * item.quantity).toFixed(2)}</li>`
                        ).join('') : '<li class="text-stone-500 italic">No items</li>';
                        
                        // Format timestamp
                        let timestamp = 'Just now';
                        if (order.createdAt && order.createdAt.toDate) {
                            const orderDate = order.createdAt.toDate();
                            timestamp = orderDate.toLocaleString();
                        }
                        
                        // Cancel button (only show if order can be cancelled)
                        let cancelButton = '';
                        if (canCancel && order.status === 'pending') {
                            cancelButton = `
                                <button onclick="cancelOrder('${orderId}')" 
                                    class="px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition-colors text-sm">
                                    Cancel Order
                                </button>
                            `;
                        }
                        
                        const orderCard = `
                            <div class="bg-white rounded-lg shadow-md p-6 border border-stone-200">
                                <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-4">
                                    <div>
                                        <h3 class="text-lg font-bold text-stone-900">Order #${orderId.slice(-6).toUpperCase()}</h3>
                                        <p class="text-sm text-stone-500">${timestamp}</p>
                                    </div>
                                    <div class="flex items-center gap-3 mt-3 md:mt-0">
                                        <span class="px-3 py-1 text-xs font-semibold rounded-full ${statusClass}">
                                            ${order.status ? order.status.toUpperCase() : 'PENDING'}
                                        </span>
                                    </div>
                                </div>
                                
                                <div class="mb-4">
                                    <h4 class="font-semibold text-stone-900 mb-2">Items:</h4>
                                    <ul class="space-y-1">
                                        ${itemsList}
                                    </ul>
                                </div>
                                
                                <div class="flex flex-col md:flex-row md:items-center md:justify-between pt-4 border-t border-stone-200">
                                    <p class="text-lg font-bold text-stone-900">Total: $${(order.total || 0).toFixed(2)}</p>
                                    <div class="mt-3 md:mt-0">
                                        ${cancelButton}
                                    </div>
                                </div>
                            </div>
                        `;
                        
                        ordersContainer.innerHTML += orderCard;
                    });
                    
                    lucide.createIcons();
                });
        }

        // Check if order can be cancelled (within 5 minutes)
        function canCancelOrder(createdAt) {
            if (!createdAt || !createdAt.toDate) return false;
            
            const orderTime = createdAt.toDate();
            const currentTime = new Date();
            const diffMinutes = (currentTime - orderTime) / (1000 * 60);
            
            return diffMinutes <= 5;
        }

        // Cancel order function
        async function cancelOrder(orderId) {
            if (!confirm('Are you sure you want to cancel this order?')) {
                return;
            }
            
            try {
                await db.collection('orders').doc(orderId).update({
                    status: 'cancelled'
                });
                alert('Order cancelled successfully!');
            } catch (error) {
                console.error('Error cancelling order:', error);
                alert('Failed to cancel order. Please try again.');
            }
        }

        // --- REAL CHECKOUT LOGIC ---
        async function checkout() {
            const checkoutBtn = document.getElementById('checkout-btn');
            checkoutBtn.disabled = true;
            checkoutBtn.textContent = 'Processing...';

            try {
                // 1. Prepare Order Data
                const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);

                const orderData = {
                    items: cart,
                    total: total,
                    status: 'pending', // This triggers the red dot in admin
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    userEmail: currentUser ? currentUser.email : 'Guest',
                    userId: currentUser ? currentUser.uid : null
                };

                // 2. Send to Firebase
                await db.collection('orders').add(orderData);

                // 3. Success Handling
                toggleCart(); // Close drawer
                cart = []; // Clear local cart
                updateCartUI(); // Reset UI
                document.getElementById('success-modal').classList.remove('hidden');

            } catch (error) {
                console.error("Order failed", error);
                alert("Failed to place order. Please try again.");
            } finally {
                checkoutBtn.disabled = false;
                checkoutBtn.textContent = 'Place Order';
            }
        }

        // --- Init ---
        listenToAvailability();
        updateCartUI();
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('res-date').setAttribute('min', today);
        const maxDate = new Date();
        maxDate.setMonth(maxDate.getMonth() + 3);
        document.getElementById('res-date').setAttribute('max', maxDate.toISOString().split('T')[0]);

    </script>
</body>

</html>
